<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- basic -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- mobile metas -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- site metas -->
    <title>OVINO</title>

    <meta name="keywords" content="">
    <meta name="description" content="">
    <meta name="author" content="">
    <!-- collapsible css -->
    <link rel="stylesheet" href={{ url_for('static', filename='css/slider/materialize_edited.css') }}>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- bootstrap css -->
    <link rel="stylesheet" href="static/css/bootstrap.min.css">
    <!-- style css -->
    <link rel="stylesheet" href="static/css/style.css">
    <!-- Responsive-->
    <link rel="stylesheet" href="static/css/responsive.css">
    <!-- Tooltip-->
    <!-- Tweaks for older IEs-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.css" media="screen">
    <link rel="stylesheet" href="./static/css/normalize.css" />
        <link rel="stylesheet" href="static/css/social_icon.css">

  </head>
  <style>
    .checked {
      color: #ad003b;
    }
  </style>
  <style>
    .solid_border {
      border: 1px;
      border-style: solid;
      color: bababa;
    }
  </style>
  <style>
    .btn {
      border:  10px;
      font-size: 20px;
    }

    .fa-social{
        font-size: 35px;
      width: 60px;
      height: 60px;
      line-height: 60px;
      text-align: center;
      text-align: center;
      text-decoration: none;
      margin: 5px 20px;
      border-radius: 50%;
      vertical-align: middle;
    }

    ::placeholder { /* Chrome, Firefox, Opera, Safari 10.1+ */
    color: rgba(0, 0, 0, 0.5);
    opacity: 1; /* Firefox */
    }

    :-ms-input-placeholder { /* Internet Explorer 10-11 */
      color: rgb(0, 0, 0, 0.5);
    }

    ::-ms-input-placeholder { /* Microsoft Edge */
      color: rgb(0, 0, 0, 0.5);
    }

  </style>
  <!-- Javascript -->
  <script type="text/javascript" src="static/js/materialize.min.js"></script>
  <!--[if lt IE 9]>
                              <!-- Back to top button -->
  <a id="button">
    <img src="/static/images/back-to-top.png" align="center">
  </a>
  <!-- body -->
  <body class="main-layout">
    <!-- loader  --
       <div align="center"><div class="loader_bg"><div class="loader"><img src="static/images/loading.gif" align="center"/></div></div></div>
                                  <!-- end loader -->
    <!-- header -->
    <header style="margin-top: 5%;">
      <!-- header inner -->
      <div class="head_top">
        <div class="header">
          <div class="container-fluid">
            <div class="row">
              <div class="col-md"></div>
              <div class="col-md-6 logo_section">
                <div class="full">
                  <div class="center-desk">
                    <div class="logo d-none d-lg-block " style=margin-top:-10%>
                      <a href="/">
                        <img src="static/images/ovino.png" alt="#" />
                      </a>
                    </div>
                    <div class="logo d-block d-lg-none">
                      <a href="/">
                        <img src="static/images/ovino.png" alt="#" />
                      </a>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-md"></div>
            </div>
          </div>
        </div>
        <!-- end header inner -->
        <main>

        <!-- banner -->
        <section class="banner_main">
          <div class="container" style=margin-top:-40px>
            <h1>Find <span class="checked">good</span> wine <span class="checked">fast</span> at your LCBO </h1>
            <div align="center">
              <div class="col-lg-3 col-md-3"></div>
              <div class="col-lg-6 col-md-6 col-s12">
                <form action="." method="GET">
                  <div class="input-field "> 
                    {% if df_store %} 
                          <input type="text" name="my_address" id="my_address" style="width:100%;font-size:25px; font-family: FontAwesome; padding-left: 30px;" value="{{my_address}}" autocomplete="one-time-code" /> 
                    {% else %} 
                          <input type="text" name="my_address" id="my_address" style="width:100%;font-size:25px; font-family: FontAwesome; padding-left: 30px;" placeholder="Enter Your Location..." autocomplete="one-time-code" /> 
                    {%endif%} 
                      <label class="label-icon" for="search">
                      <i class="material-icons" style="padding-left: 5px;">search</i>
                      </label>
                  </div>
                </form>
              </div>
              <div class="col-lg-3 col-md-3"></div>
            </div>


            {% if len_wine_cards > 0 %} 
            {{sndmap.js}}
            {% else %}
            <br><br><br><br><br><br><br><br><br><br><br>
            {%endif%}

            <!-- MAP DISPLAY -->
            <div class="row" style=margin-top:10px>
              <div class="col-sm">
                <div class="titlepage"> {% if df_store %} <h2 style=margin-top:40px>LCBO</h2>
                  <h2 style=margin-top:-10px>
                    <font color="#ad003b">{{df_store['name'].split('(')[0]}}</font>
                  </h2> {%if '(' in df_store['name'] %} <h2 style=margin-top:-10px>
                    <font color="#ad003b">{{'('+df_store['name'].split('(')[1]}}</font>
                  </h2> {%endif%} <h3>
                    <font size=5>{{df_store['address']}}
                      <br> {{df_store['city']}}
                      <br> {{df_store['phone_number']}}
                    </font>
                  </h3> {%endif%}
                </div>
              </div>
              <div class="col-md">
                <div align="center" style=margin-top:0px> {{sndmap.html}} </div>
              </div>
            </div> 
            {%if len_wine_cards > 0%} 
            <a id="anchor-filter"></a>
            <div class="row" style=margin-top:50px>
              
              <div class="col-md">
                <div class="logo">
                  <img src="static/images/ovino_v.png" style="max-width: 35%;" />
                </div>
              </div>
              <div class="col-md-8 ">
                <div class="full">
                  <div class="center-desk">
                    {%if my_wdr_dict and vivino_username%}
                      <h1 style=margin-top:10px>Scroll for <font color="#ad003b">AI-recommended</font> bottles for <font color="#ad003b">{{vivino_username}}</font>!</h1>
                      <h4><font color="#ad003b">AI-generated<div data-toggle="tooltip" data-placement="top" title="AI-generated recommendations are based on users with very similar ratings as yours!" style="display:inline;"><font size=3 style="vertical-align: text-top; text-align: left;"> &#9432; </font></div></font> suggestions powered by <font color="#ad003b">your preferences</font> and 35,000 Vivino users.</h4>
                    {% else %}
                      <h1 style=margin-top:10px>Scroll for recommended bottles!</h1>
                    {% endif %}
                  </div>
                </div>
              </div>
              <div class="col-md">
                <div class="logo">
                  <img src="static/images/ovino_v.png" style="max-width: 35%;" />
                </div>
              </div>
              <div class="row">
                <div class="col-md-2"></div>
                <div class="col-md-8">
                {%if vivino_username and not my_wdr_dict%}
                <h3 style=margin-top:10px>
                Unfortunately, no recommendations could be found for <font color="#ad003b">{{vivino_username}}</font> or the username is invalid. Here are some general recommendations!
                </h3>
                {% endif %}
                </div>
              </div>
            </div> {% endif %}
          </div>
        </section>
      </div>
    </header>
    <!-- end banner -->
    <!-- end header -->





    <!-- store --> 
    {% if df_store %} 
    <div class="store" style="margin-right: 30px;margin-left: 30px; margin-top:-20px;">
      
      <form action="#" method="GET">
        <div class="row">
          <div class="col-lg-2 col-md-2"></div>
          <div class="col-lg-8 col-md-8 col-s12">
            <ul class="collapsible">
              <li>

                <div class="collapsible-header">
                  <i class="material-icons" style="font-size: 30px; padding-top: 2px;">tune</i>
                  <h2>Filters & Experimental AI</h2>
                </div>

                <div class="collapsible-body #ffffff white ">
                  <div class="row">

                    <div class="col-lg-6 col-md-6 col-s12 h4">
                      <h2>Min Price </h2>
                      <div class="input-field inline">
                        <input id="price_min" name="price_min" type="number" value={{form.price_min.data}} min="1" max={{form.price_max.data-1}} style="text-align-last:center; font-size:20px;" oninput="outputUpdateInt(price_min.value,price_min.name)">
                        <label class="label-icon" for="attach_money" style="top: -3px;">
                          <i class="material-icons" style="padding-left: 5px; padding-top: 1px;">attach_money</i>
                        </label>
                      </div>
                    </div>


                    <div class="col-lg-6 col-md-6 col-s12 h4">
                      <h2>Max Price </h2>
                      <div class="input-field inline">
                        <input id="price_max" name="price_max" type="number" value={{form.price_max.data}} min={{form.price_min.data+1}} max="1000000" style="text-align-last:center; font-size:20px;" oninput="outputUpdateInt(price_max.value,price_max.name)">
                        <label class="label-icon" for="attach_money" style="top: -3px;">
                          <i class="material-icons" style="padding-left: 5px; padding-top: 1px;">attach_money</i>
                        </label>
                      </div>
                    </div>


                  </div>


                  <div class="row">
                    <div class="col-lg-6 col-md-6 col-s12">
                      <h2>
                        <i class="fa fa-star checked h3"></i> Rating: <span id="val_rating_min" color="#ad003b">{{ "%.1f"|format(form.rating_min.data)}}</span>+
                      </h2>
                      <div class="slidecontainer">
                        <p class="range-field">
                          <input id="rating_min" min="3.0" max="4.2" name="rating_min" oninput="outputUpdate(rating_min.value,rating_min.name)" step="0.2" type="range" value={{form.rating_min.data}} style="margin-top:  20px; ">
                        </p>
                      </div>
                    </div>
                    <div class=" col-lg-6 col-md-6 col-s12 h4">
                      <h2>Sort by</h2>
                      {{form.sort_by}}
                    </div>
                  </div>

                  <div class="row">
                    <!-- Experimental AI -->
                    <div class="col-lg-3 col-md-3"></div>
                    <div class="col-lg-6 col-md-6 col-s12">
                      <h2>
                        Experimental AI Recommender <div data-toggle="tooltip" data-placement="top" title="Copy and paste your Vivino profile's URL: https://www.vivino.com/users/stephen.ro1. Please wait for the filter to complete if you have several hundred reviews or more!" style="display:inline;"><font size=3 style="vertical-align: text-top; text-align: left;"> &#9432; </font></div>
                        <div class="input-field inline col s12">
                            <input placeholder=" e.g., https://www.vivino.com/users/stephen.ro1" id="vivino_username" name="vivino_username" type="text" style = "width: 100%; padding-left: 30px;" oninput="outputUpdateInt(vivino_username.value,vivino_username.name)" >
                            <label class="label-icon" for="account_circle" style="top: -3px;">
                              <i class="material-icons" style="padding-left: 5px; padding-top: 1px;">account_circle</i>
                            </label>
                        </div>
                      </h2>
                    </div>   
                  </div>
                  <div class="row">
                    <div class="col l12 m12 s12">
                      <div class="br3 box pa3 mt2 center-align h2">
                        <input type="hidden" name="my_address" value="{{my_address}}" />
                        {{ form.submit(class_="btn") }}
                      </div>
                    </div>
                  </div>

                </div>
              </li>
            </ul>
          </div>
          <div class="col-lg-2 col-md-2"></div>
        </div>
      </form>






      <div class="row">
        <div class="col-lg-2 col-md-2"></div>
        <div class="col-lg-8 col-md-8">
          <!-- WINE CAROUSEL --> {% if len_wine_cards > 0 %} <ol> {%for i in range(len_wine_cards)%} {% set wine_card = wine_cards[i] %} <div class="black_bg">
              <div class="row d_flex">
                <div class="col-md-4">
                  <div class="store_box ">
                    <figure>
                      <img src={{wine_card['url_thumbnail']}} style="width:100%;" />
                    </figure>
                  </div>
                </div>
                <div class="col-md-8">
                  <div class="store_box ">
                    <h3>{{wine_card['name']}}</h3>
                    <h4>{{wine_card['varietal']}}, {{wine_card['category']}}
                      <br> Made in {{wine_card['made_in']}}
                      <br>By {{wine_card['brand']}}
                    </h4>
                    <h3 style="padding-top: 20px;">
                      <font color="#ad003b">{{"${:.2f}".format( wine_card['price'] )}} </font>
                    </h3>
                    <h4 style=margin-top:0px>
                      <font color="#ad003b" size=5>
                        {{wine_card['pos']}} of {{wine_card['pos']+wine_card['neg']}} recommend this price! <div data-toggle="tooltip" data-placement="top" title="{{wine_card['pos']}} people paid more and found good value. {{wine_card['neg']}} paid less and found poor value." style="display:inline;">
                          <font size=3 style="vertical-align: text-top;"> &#9432; </font>
                        </div>
                      </font>
                    </h4>
                    <h4 style="margin-top:10px;">
                      <font size=5> {% for i in range(5) %} {% if wine_card['ratings_average'] - i >= 0.89 %} <span class="fa fa-star checked"></span> {% elif wine_card['ratings_average'] - i >= 0.39 %} <span class="fa fa-star-half-empty checked"></span> {% else %} <span class="fa fa-star-o checked"></span> {%endif%} {%endfor%} </font>
                      <span>
                        <font color="#ad003b" size=5.5>{{wine_card['ratings_average']}}</font>
                      </span>
                      <font color="#ad003b">({{wine_card['ratings_count']}}) </font>
                      <!-- <span><font color="#ad003b" size=5.5>{{wine_card['ratings_average']}}</font> &nbsp;
                      </span> -->
                    </h4>
                    <br>
                    <h4>
                      {{wine_card['description'].strip()}}
                      <br>
                      <br>
                      {{"{:.1f}".format( wine_card['abv'])}}% ABV <br>
                      {{"%d"%(wine_card['calories']) }} Cal per {{wine_card['volume']}} ml bottle<div data-toggle="tooltip" data-placement="top" title="Unofficial estimate from ABV, reported sugar content, and bottle volume." style="display:inline;">
                        <font size=3 style="vertical-align: text-top;"> &#9432; </font>
                      </div> <br>
                      LCBO#: <a href={{wine_card["url"]}} color="#ad003b">{{wine_card['sku']}} </a>
                      

                    </h4>
                    <!--                            <a class="read_more" href={{wine_card['details_url']}}>See LCBO SKU#{{wine_card['sku']}}</a>    -->
                  </div>
                </div>
              </div>
            </div> {%endfor%} </ol> &nbsp; {% else %} <h1> Sorry! No wines were found. <br>Please select different filters and try again. </h1> {% endif %}
          <!-- end FOR LOOP  -->
          <!-- end WINE CAROUSEL -->
        </div>
        <div class="col-lg-2 col-md-2"></div>
      </div>
    </div>
    <div class="row">
      <div class="col l12 m12 s12">
        <div align="center">
          <div class="container">
            <div id="pagination-long"></div>
          </div>
        </div>
      </div>
    </div>
    </div> 
    {% endif %}
    <!-- end store -->

  </main>




<!--  footer -->
    <footer class="page-footer" style="position:relative;bottom:0;left:0;width:100%;">
      <div class="container">
        <div class="row">
          <div class="col l6  s12">
            <h4 class="white-text"></h4>
              <a href="https://www.linkedin.com/in/stephenro/" class="fa fa-social fa-linkedin"></a>
              <a href="https://github.com/royourboat" class="fa fa-social fa-github" style="color:#171515; font-size:70px;"></a>
              <a href="https://royourboat.github.io/" class="fa fa-social fa-user" ></a>
          </div>
          <div class="col l6 s12">
            
                <a href="{{url_for('about')}}" style="font-size:40px; color:white;">About</a>
              
          </div>
        </div>
      </div>
      <div class="footer-copyright">
        <div class="container"> Stephen Ro Â© 2023 Copyright </div>
      </div>
    </footer>
    <!-- end footer -->





    <!-- Javascript files-->
    <script src="static/js/jquery.min.js"></script>
    <script src="static/js/backtotopbutton.js"></script>
    <script src="static/js/bootstrap.bundle.min.js"></script>
    <script src="static/js/jquery-3.0.0.min.js"></script>
    <script src="static/js/plugin.js"></script>
    <!-- sidebar -->
    <script src="static/js/jquery.mCustomScrollbar.concat.min.js"></script>
    <script src="static/js/custom.js"></script>
    <script src="static/js/pagination.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        var elems = document.querySelectorAll('.collapsible');
        var instances = M.Collapsible.init(elems, {});
      });
      document.addEventListener('DOMContentLoaded', function() {
        var elems = document.querySelectorAll('select');
        var instances = M.FormSelect.init(elems, options);
      });

      function outputUpdate(val, id) {
        document.querySelector('#val_' + id).innerHTML = parseFloat(val).toFixed(1);
      }

      function outputUpdateInt(val, id) {
        document.querySelector('#val_' + id).innerHTML = parseInt(val);
      }
    </script>
    <script>
      $(function() {
        $(function() {
          $('#pagination-long').materializePagination({
            align: 'center',
            lastPage: {{total_num_pages}},
            firstPage: 1,
            urlParameter: 'page',
            useUrlParameter: true,
            onClickCallback: function(requestedPage) {
              console.log('Requested page from #pagination-long: ' + requestedPage);
            }
          });
        });
      });
    </script>
    <script>
      const urlParams = new URLSearchParams(window.location.search);
      const page = urlParams.get('page');
      const submit = urlParams.get('submit');
      var element_to_scroll_to = document.getElementById('anchor-filter');
      if (page > 1 || submit) {
        element_to_scroll_to.scrollIntoView({
          behavior: "instant"
        });
      }
    </script>
    <script type="text/javascript">
      $(function() {
        $("[rel='tooltip']").tooltip();
      });
    </script>
  </body>
</html>